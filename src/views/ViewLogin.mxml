<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark" title="Log in to Sina Weibo">
	<fx:Script>
		<![CDATA[
			import com.sina.microblog.MicroBlog;
			import com.sina.microblog.events.MicroBlogErrorEvent;
			import com.sina.microblog.events.MicroBlogEvent;
			
			import mx.events.FlexEvent;
			
			protected function buttonback_clickHandler(event:MouseEvent):void
			{
				navigator.popView();
			}
			
			protected function loginHd(event:MouseEvent):void
			{
				
				(this.data[0] as MicroBlog).access_token=token.text;
				
				if(isAutoLogin.selected){
					var so:SharedObject=SharedObject.getLocal("aTK");
					so.data.atk=(this.data[0] as MicroBlog).access_token;
				}else{
					so.clear();
				}
				navigator.popView();
				
				
				//testAPI();
				
				//(this.data[0] as MicroBlog).verifyCredentials();
				prog.text="logging";
			}
			private function testAPI():void
			{
				(this.data[0] as MicroBlog).addEventListener("callWeiboApiResult", callWeiboApiResult);
				(this.data[0] as MicroBlog).addEventListener("callWeiboApiError", callWeiboApiError);
				(this.data[0] as MicroBlog).callWeiboAPI("2/account/get_uid", null, "GET", "callWeiboApiResult", "callWeiboApiError"); 
			}
			
			/**
			 * 成功调用api
			 */
			private function callWeiboApiResult(e:MicroBlogEvent):void
			{
				trace("uid:"+e.result.uid); //按照线上文档返回格式格式： {"uid":"3456676543"}
				prog.text="uid:"+e.result.uid;
			}
			
			/**
			 * 调用api失败，获取服务器返回的错误信息
			 */
			private function callWeiboApiError(e:MicroBlogErrorEvent):void
			{
				trace(e.message);
			}
			
			
			
						
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
	<s:navigationContent>
		<s:Button label="&lt; Weibo" click="buttonback_clickHandler(event)"/>
	</s:navigationContent>
	<s:VGroup left="0" right="0" top="0" bottom="0" gap="20" 
			  horizontalCenter="0" paddingBottom="10" paddingLeft="20" paddingRight="20"
			  paddingTop="30" verticalCenter="0">
		<s:TextInput id="token" width="100%" prompt="请输入得到的token" softKeyboardType="email" returnKeyLabel="go" enter="loginHd(null)"/>
		<s:CheckBox id="isAutoLogin" label="自动登录" selected="true"/>
		<s:HGroup width="100%" gap="15" verticalAlign="middle">
			<s:Button width="232" label="登录" click="loginHd(event)" />
			<s:Label id="prog" text=""/>
		</s:HGroup>
	</s:VGroup>
</s:View>
